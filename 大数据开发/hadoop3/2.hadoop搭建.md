# Hadoopæ­å»º

# 1.è™šæ‹Ÿæœºå®‰è£…

> 1.å®‰è£…è™šæ‹Ÿæœº,IPåœ°å€192.168.10.100ã€ä¸»æœºåç§°hadoop100ã€å†…å­˜4Gã€ç¡¬ç›˜50G

ä¿®æ”¹å­ç½‘å’Œç½‘å…³ä¿æŒåœ¨åŒä¸€ç½‘æ®µä¸­

![image-20230817175323258](img.assets\image-20230817175323258.png)

![image-20230817175411591](img.assets\image-20230817175411591.png)



> 2.æ”¹ä¸ºé™æ€IP

`vim /etc/sysconfig/network-scripts/ifcfg-ens33`è¿›å…¥é…ç½®æ–‡ä»¶

```
BOOTPROTO="static"
â€¦
IPADDR=1192.168.79.100
GATEWAY=192.168.79.2
DNS1=192.168.79.2
```

> 3.å»ºç«‹ä¸»æœºåæ˜ å°„

- Linuxç³»ç»Ÿè¿›å…¥é…ç½®æ–‡ä»¶`vim /etc/hosts`ï¼ŒåŠ ä¸Šä¸»æœºååŠå…¶å¯¹åº”IPåœ°å€ æˆ–è€… `echo "192.168.79.100 hadoop100" >> /etc/hosts`
- å¦‚æœä¸»æœºåä¸æ˜¯hadoop100å¯é€šè¿‡`echo "hadoop100" > /etc/hostname`æ¥ä¿®æ”¹
- å†è¿›windowsç³»ç»ŸC:\Windows\System32\drivers\etcåŒæ ·ä¿®æ”¹hostsæ–‡ä»¶



> 4.å®‰è£…è½¯ä»¶åŒ…

```
yum install -y epel-release
```

Extra Packages for Enterprise Linuxæ˜¯ä¸ºâ€œçº¢å¸½ç³»â€çš„æ“ä½œç³»ç»Ÿæä¾›é¢å¤–çš„è½¯ä»¶åŒ…

- net-toolï¼šå·¥å…·åŒ…é›†åˆï¼ŒåŒ…å« ifconfig ç­‰å‘½ä»¤

```
yum install -y net-tools
```

- vimï¼šç¼–è¾‘å™¨

```
yum install -y vim
```



>5.å…³é—­é˜²ç«å¢™åŠå…¶å¼€æœºè‡ªå¯

- å…³é—­é˜²ç«å¢™ï¼š`systemctl stop firewalld`
- å…³é—­å¼€æœºè‡ªå¯ï¼š`systemctl disable firewalld.service`



> 6.ä¸æ˜¯rootæƒé™çš„æ·»åŠ rootæƒé™

- root`ç”¨æˆ·`vim /etc/sudoers`ç¬¬91è¡ŒåŠ ä¸Š`è¯¥ç”¨æˆ·å ALL=(ALL) NOPASSWD: ALL`ï¼Œç”±äºæ˜¯åªè¯»æ–‡ä»¶ï¼Œé€€å‡ºæ—¶`wq!
- å°†ç”¨æˆ·`usermod -g wheel è¯¥ç”¨æˆ·å` æ·»åŠ åˆ°wheelç»„ä¸­ï¼ŒåŠ ä¸Š`NOPASSWD`å³å¯



> 7.åœ¨/optç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹

- åˆ›å»ºæ–‡ä»¶å¤¹(JDKå’ŒHadoopå®‰è£…ç›®å½•)

```
mkdir /opt/module
mkdir /opt/software
```

- ä¿®æ”¹æ‰€æœ‰è€…ã€æ‰€å±ç»„(é€‰æ‹©rootç”¨æˆ·ç™»å½•çš„è¯å¯ä»¥ä¸ä¿®æ”¹)

```
chown xh:xh /opt/module
chown xh:xh /opt/software
```



> 8.å¸è½½è™šæ‹Ÿæœºè‡ªå¸¦çš„JDK

- å…ˆæ£€æŸ¥è™šæ‹Ÿæœºæ˜¯å¦è‡ªå¸¦äº†JDKï¼š`rpm -qa | grep -i java`
- ä¸€é”®åˆ é™¤æ“ä½œï¼š`rpm -qa | grep -i java | xargs -n1 rpm -e --nodeps`



> 9.é‡å¯ reboot



# 2.å…‹éš†ä¸‰å°è™šæ‹Ÿæœº

æ‹·è´è™šæ‹Ÿæœº,IPåœ°å€**192.168.79.102 Hadoop102**,**192.168.79.103 Hadoop103**,**192.168.79.104 Hadoop104**

è®¾ç½®ipå’Œä¸»æœºåæ˜ å°„ï¼Œä¿æŒä¸‰å°ä¸»æœºå¯ä»¥é€šè¿‡ä¸»æœºåè¿æ¥

```
192.168.79.102 hadoop102
192.168.79.103 hadoop103
192.168.79.104 hadoop104
```

> é…ç½®windosä¸»æœºæ˜ å°„





# 3.å®‰è£…JDKå’ŒHadoop

åœ¨Hadoop102ä¸Šå®‰è£…JDKå’ŒHadoopåˆ°`/opt/module`ç›®å½•,å…¶ä½™é€‰æ‹©æ‹·è´çš„æ–¹å¼å®‰è£…



>Hadoopå®‰è£…

```shell
tar -zxvf hadoop-3.1.3.tar.gz -C /opt/module/
```

ä¿®æ”¹é…ç½®æ–‡ä»¶

```shell
vim /etc/profile
```

```sh
#HADOOP_HOME
export HADOOP_HOME=/opt/module/hadoop-3.1.3
export PATH=$PATH:$HADOOP_HOME/bin
export PATH=$PATH:$HADOOP_HOME/sbin
```

åˆ·æ–°å½“å‰çš„shellç¯å¢ƒ

```shell
source /etc/profile
```

æœ€åæŸ¥çœ‹æ˜¯å¦æˆåŠŸå®‰è£…

```
hadoop
```

>å…¶ä¸­é‡è¦ç›®å½•ï¼š
>
>bin ç›®å½•ï¼šå­˜æ”¾å¯¹ Hadoop ç›¸å…³æœåŠ¡ï¼ˆ HDFS,YARNï¼‰è¿›è¡Œæ“ä½œçš„è„šæœ¬
>etc ç›®å½•ï¼š Hadoop çš„é…ç½®æ–‡ä»¶ç›®å½•ï¼Œå­˜æ”¾ Hadoop çš„é…ç½®æ–‡ä»¶
>lib ç›®å½•ï¼šå­˜æ”¾ Hadoop çš„æœ¬åœ°åº“ï¼ˆå¯¹æ•°æ®è¿›è¡Œå‹ç¼©è§£å‹ç¼©åŠŸèƒ½ï¼‰
>sbin ç›®å½•ï¼šå­˜æ”¾å¯åŠ¨æˆ–åœæ­¢ Hadoop ç›¸å…³æœåŠ¡çš„è„šæœ¬ï¼›share ç›®å½•ï¼šå­˜æ”¾ Hadoop çš„ä¾èµ– jar åŒ…ã€ æ–‡æ¡£å’Œå®˜æ–¹æ¡ˆä¾‹



# 4.Hadoopè¿è¡Œæ¨¡å¼

[Hadoopå®˜æ–¹ç½‘ç«™](https://hadoop.apache.org/)

Hadoop è¿è¡Œæ¨¡å¼åŒ…æ‹¬ï¼šæœ¬åœ°æ¨¡å¼ã€ä¼ªåˆ†å¸ƒå¼æ¨¡å¼ä»¥åŠå®Œå…¨åˆ†å¸ƒå¼æ¨¡å¼

- `æœ¬åœ°ï¼ˆç‹¬ç«‹ï¼‰æ¨¡å¼`ï¼šæ— éœ€è¿è¡Œä»»ä½•å®ˆæŠ¤è¿›ç¨‹ï¼Œæ‰€æœ‰ç¨‹åºéƒ½åœ¨åŒä¸€ä¸ªJVMä¸Šæ‰§è¡Œï¼Œåœ¨ç‹¬ç«‹æ¨¡å¼ä¸‹æµ‹è¯•å’Œè°ƒè¯•MapReduceéƒ½éå¸¸æ–¹ä¾¿ï¼Œå› æ­¤è¯¥æ¨¡å¼åœ¨å¼€å‘é˜¶æ®µæ¯”è¾ƒé€‚åˆï¼ˆå­¦ä¹ ç”¨ï¼‰
- `ä¼ªåˆ†å¸ƒå¼æ¨¡å¼`ï¼šHadoopå®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨æœ¬åœ°æœºå™¨ä¸Šï¼Œæ¨¡æ‹Ÿä¸€ä¸ªå°è§„æ¨¡çš„é›†ç¾¤
- `å®Œå…¨åˆ†å¸ƒå¼`ï¼šHadoopå®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨ä¸€ä¸ªé›†ç¾¤ä¸Šï¼ˆä¼ä¸šç”¨)

![image-20230818143928626](img.assets\image-20230818143928626.png)

## 4.1 æœ¬åœ°è¿è¡Œæ¨¡å¼ï¼ˆå®˜æ–¹ WordCountï¼‰

>åœ¨ hadoop-3.1.3 æ–‡ä»¶ä¸‹é¢åˆ›å»ºä¸€ä¸ª wcinput æ–‡ä»¶å¤¹

```
mkdir wcinput
# è¿›å…¥æ–‡ä»¶å¤¹ä¸­
cd wcinput
```

>ç¼–è¾‘word.txtæ–‡æœ¬

```
vim word.txt
# æ“ä½œå¦‚ä¸‹
11 11 11
22 22
33
```

> å›åˆ°Hadoopç›®å½•ä¸‹æ‰§è¡Œ

```java
hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount wcinput wcoutput
```

- wordcount ç»Ÿè®¡æ–‡æœ¬æ•°é‡
- wcinput è¾“å…¥è·¯å¾„
- wcoutput è¾“å‡ºè·¯å¾„(è¾“å‡ºè·¯å¾„ä¸èƒ½å­˜åœ¨ï¼Œå¦åˆ™å›æŠ›å‡ºå¼‚å¸¸)

> æŸ¥çœ‹è¾“å‡ºæ–‡ä»¶

![image-20230818145607097](img.assets\image-20230818145607097.png)

> æŸ¥çœ‹ç»“æœ

```shell
cat part-r-00000
```

![image-20230818150255320](img.assets\image-20230818150255320.png)

> å¼‚å¸¸ä¿¡æ¯

![image-20230818150015167](img.assets\image-20230818150015167.png)



## 4.2 å®Œå…¨åˆ†å¸ƒå¼è¿è¡Œæ¨¡å¼

- å‡†å¤‡ 3 å°å®¢æˆ·æœºï¼ˆå…³é—­é˜²ç«å¢™ã€é™æ€ IPã€ä¸»æœºåç§°ï¼‰
- å®‰è£… JDK
- é…ç½®ç¯å¢ƒå˜é‡
- å®‰è£… Hadoop
- é…ç½®ç¯å¢ƒå˜é‡
- é…ç½®é›†ç¾¤
- å•ç‚¹å¯åŠ¨
- é…ç½® ssh
- ç¾¤èµ·å¹¶æµ‹è¯•é›†ç¾¤



### 4.2.1 scp å®‰å…¨æ‹·è´

ğŸ¯è¯­æ³•ï¼š`scp [é€‰é¡¹] è¦æ‹·è´çš„æ–‡ä»¶è·¯å¾„/åç§° ç›®çš„ç”¨æˆ·@ä¸»æœº:ç›®çš„è·¯å¾„/åç§°`

> scp -r   $pdir/$fname       $user@$host:$pdir/$fname 
>
> å‘½ä»¤ é€’å½’ è¦æ‹·è´çš„æ–‡ä»¶è·¯å¾„/åç§° ç›®çš„åœ°ç”¨æˆ·@ä¸»æœº:ç›®çš„åœ°è·¯å¾„/åç§°

ğŸ¯åŠŸèƒ½ï¼šå¯ä»¥å®ç°æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®æ‹·è´

ğŸ¯é€‰é¡¹ï¼š

| é€‰é¡¹ | è¯´æ˜                                                |
| ---- | --------------------------------------------------- |
| -C   | è¿™ä¼šåœ¨å¤åˆ¶è¿‡ç¨‹ä¸­å‹ç¼©æ–‡ä»¶æˆ–ç›®å½•                      |
| -P   | å¦‚æœé»˜è®¤ SSH ç«¯å£ä¸æ˜¯ 22ï¼Œåˆ™ä½¿ç”¨æ­¤é€‰é¡¹æŒ‡å®š SSH ç«¯å£ |
| -r   | æ­¤é€‰é¡¹é€’å½’å¤åˆ¶ç›®å½•åŠå…¶å†…å®¹                          |
| -p   | ä¿ç•™æ–‡ä»¶çš„è®¿é—®å’Œä¿®æ”¹æ—¶é—´                            |

ğŸ¯ä¾‹å­ï¼š

å‰æï¼šåœ¨ hadoop102ã€hadoop103ã€hadoop104 éƒ½å·²ç»åˆ›å»ºå¥½çš„/opt/moduleã€  /opt/software ä¸¤ä¸ªç›®å½•ï¼Œå¹¶ä¸”å·²ç»æŠŠè¿™ä¸¤ä¸ªç›®å½•ä¿®æ”¹ä¸ºxh:xh

```shell
# æ–‡ä»¶å¤¹åœ¨hadoop102ä¸Šï¼Œæ‹·è´åˆ°å…¶ä»–è™šæ‹Ÿæœºä¸Š
# 102 --> 103
scp -r /opt/module/jdk1.8.0_212  root@192.168.79.103:/opt/module
# 103 <-- 102
scp -r root@192.168.79.102:/opt/module/hadoop/ /opt/module/
# (103)102 --> 104
scp -r /opt/module/*  root@192.168.79.104:/opt/module/
```

```
ä¸Šé¢å‘½ä»¤å°†æœ¬åœ°ç›®å½•xxxå¤åˆ¶åˆ°è¿œç¨‹ module ç›®å½•ä¸‹ï¼Œä¼šåˆ›å»ºå­ç›®å½•
```



### 4.2.2 rsync è¿œç¨‹åŒæ­¥å·¥å…·

> rsync ä¸»è¦ç”¨äºå¤‡ä»½å’Œé•œåƒã€‚å…·æœ‰é€Ÿåº¦å¿«ã€é¿å…å¤åˆ¶ç›¸åŒå†…å®¹å’Œæ”¯æŒç¬¦å·é“¾æ¥çš„ä¼˜ç‚¹

ğŸ¯rsync å’Œ scp åŒºåˆ«ï¼šç”¨ rsync åšæ–‡ä»¶çš„å¤åˆ¶è¦æ¯” scp çš„é€Ÿåº¦å¿«ï¼Œ**rsync åªå¯¹å·®å¼‚æ–‡ä»¶åšæ›´æ–°**ã€‚scp æ˜¯æŠŠæ‰€æœ‰æ–‡ä»¶éƒ½å¤åˆ¶è¿‡å»
ğŸ¯è¯­æ³•ï¼š`rsync [é€‰é¡¹] è¦æ‹·è´çš„æ–‡ä»¶è·¯å¾„/åç§° ç›®çš„ç”¨æˆ·@ä¸»æœº:ç›®çš„è·¯å¾„/åç§°`

>rsync  -av 	$pdir/$fname 		$user@$host:$pdir/$fname 
>
>å‘½ä»¤  é€‰é¡¹å‚æ•°   è¦æ‹·è´çš„æ–‡ä»¶è·¯å¾„/åç§°   ç›®çš„åœ°ç”¨æˆ·@ä¸»æœº:ç›®çš„åœ°è·¯å¾„/åç§°

ğŸ¯é€‰é¡¹ï¼š

| é€‰é¡¹ | åŠŸèƒ½         |
| ---- | ------------ |
| -a   | å½’æ¡£æ‹·è´     |
| -v   | æ˜¾ç¤ºå¤åˆ¶è¿‡ç¨‹ |
| -l   | æ‹·è´ç¬¦å·é“¾æ¥ |

ğŸ¯ä¾‹å­ï¼š

```shell
# æ›´æ–°åŒæ­¥hadoop103é‡Œé¢hadoopå†…å®¹
rsync -av hadoop/ root@192.168.79.103:/opt/module/hadoop/
```

>**æ³¨æ„**ï¼š
>
>1. å¦‚æœåªæƒ³åŒæ­¥æºç›®å½•sourceé‡Œé¢çš„å†…å®¹åˆ°ç›®å½•destinationï¼Œåˆ™éœ€è¦åœ¨æºç›®å½•åé¢åŠ ä¸Šæ–œæ 
>2. ä¸Šé¢å‘½ä»¤æ‰§è¡Œåï¼Œsourceç›®å½•é‡Œé¢çš„å†…å®¹ï¼Œå°±éƒ½è¢«å¤åˆ¶åˆ°äº†destinationç›®å½•é‡Œé¢ï¼Œä¸ä¼šåœ¨destinationä¸‹é¢åˆ›å»ºä¸€ä¸ªsourceå­ç›®å½•



### 4.2.3 xsync é›†ç¾¤åˆ†å‘è„šæœ¬

ğŸ¯éœ€æ±‚ï¼šå¾ªç¯å¤åˆ¶æ–‡ä»¶åˆ°æ‰€æœ‰èŠ‚ç‚¹çš„ç›¸åŒç›®å½•ä¸‹
ğŸ¯æœŸå¾…è„šæœ¬ï¼š`xsync è¦åŒæ­¥çš„æ–‡ä»¶åç§°`
ğŸ¯å°†è„šæœ¬æ”¾åœ¨å£°æ˜äº†å…¨å±€ç¯å¢ƒå˜é‡çš„è·¯å¾„ä¸­

> æŸ¥çœ‹å…¨å±€ç¯å¢ƒå˜é‡è·¯å¾„

```
echo $PATH
```

> /usr/local/sbin:
>
> /usr/local/bin:
>
> /usr/sbin:/usr/bin:
>
> /root/bin: #åœ¨rootç›®å½•ä¸‹çš„binç›®å½•ä¸­å¯ä»¥å…¨å±€ä½¿ç”¨
>
> /opt/module/jdk1.8.0_212/bin:
>
> /opt/module/jdk1.8.0_212/bin:
>
> /opt/module/jdk1.8.0_212/bin:
>
> /opt/module/hadoop-3.1.3/bin:
>
> /opt/module/hadoop-3.1.3/sbin

**åˆ›å»º`xsync`è„šæœ¬:**

>å‘ç°`/root/bin`è·¯å¾„ï¼Œæ•…é€‰æ‹©åœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º`bin`ç›®å½•ï¼Œåˆ›å»ºè„šæœ¬`xsync`å…¨å±€å¯ç”¨
>
>vim xsync

```sh
#!/bin/bash
#1. åˆ¤æ–­å‚æ•°ä¸ªæ•°
if [ $# -lt 1 ]
then
	echo Not Enough Arguement!
	exit;
fi
#2. éå†é›†ç¾¤æ‰€æœ‰æœºå™¨
for host in 192.168.79.102 192.168.79.103 192.168.79.104
do
	echo ==================== $host ====================
 	#3. éå†æ‰€æœ‰ç›®å½•ï¼ŒæŒ¨ä¸ªå‘é€
 	for file in $@
 	do
  		#4. åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨
  		if [ -e $file ]
   			then
			     #5. è·å–çˆ¶ç›®å½•
				 pdir=$(cd -P $(dirname $file); pwd)
				 #6. è·å–å½“å‰æ–‡ä»¶çš„åç§°
				 fname=$(basename $file)
				 ssh $host "mkdir -p $pdir"
				 rsync -av $pdir/$fname $host:$pdir
			else
			     echo $file does not exists!
		fi
 	done
done
```

> è®¾ç½®å¯æ‰§è¡Œæƒé™

```
chmod +x xsync
```

> æµ‹è¯•

```shell
xsync /root/bin
```

>åŒæ­¥ç¯å¢ƒå˜é‡é…ç½®ï¼ˆroot æ‰€æœ‰è€…ï¼‰
>
>**æ³¨æ„ï¼šå¦‚æœç”¨äº† sudoï¼Œé‚£ä¹ˆ xsync ä¸€å®šè¦ç»™å®ƒçš„è·¯å¾„è¡¥å…¨ã€‚**  --> `sudo ./bin/xsync`

```
xsync /etc/profile
```

è®©ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ

```
source /etc/profile
```



### 4.2.4 ssh æ— å¯†ç ç™»å½•é…ç½®

> é…ç½®ssh

åŸºæœ¬è¯­æ³•

**`ssh å¦ä¸€å°ç”µè„‘çš„ IP åœ°å€`**

![image-20230818155929781](img.assets\image-20230818155929781.png)

> æ— å¯†é’¥é…ç½®

ğŸ¯å…å¯†ç™»å½•åŸç†

![image-20230818160026919](img.assets\image-20230818160026919.png)

> è¿›å…¥åˆ°/rootç›®å½•ï¼Œåªè¦æ‰§è¡Œè¿‡`sshå‘½ä»¤`,åœ¨éšè—ç›®å½•ä¸‹å°±æœ‰åº”è¯¥`.sshç›®å½•`

![image-20230818160651886](img.assets\image-20230818160651886.png)

> æŸ¥çœ‹ç›®å½•

![image-20230818160820602](img.assets\image-20230818160820602.png)

> åœ¨`.ssh`ç›®å½•ä¸‹ç”Ÿæˆå…¬é’¥å’Œç§é’¥

```
ssh-keygen -t rsa
```

ç„¶åæ•²ï¼ˆä¸‰ä¸ªå›è½¦ï¼‰ï¼Œå°±ä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ id_rsaï¼ˆç§é’¥ï¼‰ã€id_rsa.pubï¼ˆå…¬é’¥ï¼‰

![image-20230818160959891](img.assets\image-20230818160959891.png)

> å°†å…¬é’¥æ‹·è´åˆ°è¦å…å¯†ç™»å½•çš„ç›®æ ‡æœºå™¨ä¸Š

```
ssh-copy-id 192.168.79.102
ssh-copy-id 192.168.79.103
ssh-copy-id 192.168.79.104
```

![image-20230818161148887](img.assets\image-20230818161148887.png)

> æŸ¥çœ‹æ–‡ä»¶`authorized_keys`

![image-20230818161344109](img.assets\image-20230818161344109.png)

> åœ¨å…¶ä»–æœåŠ¡å™¨ä¸Šæ‰§è¡Œç›¸åŒçš„æ“ä½œ



### 4.2.5 Hadoopé›†ç¾¤é…ç½®

>NameNode å’Œ SecondaryNameNode ä¸è¦å®‰è£…åœ¨åŒä¸€å°æœåŠ¡å™¨ï¼Œå¾ˆæ¶ˆè€—å†…å­˜ï¼Œ
>
>ResourceManager ä¹Ÿå¾ˆæ¶ˆè€—å†…å­˜ï¼Œä¸è¦å’Œ NameNodeã€SecondaryNameNode é…ç½®åœ¨åŒä¸€å°æœºå™¨ä¸Š

ğŸ¯é›†ç¾¤é…ç½®éƒ¨ç½²

|      | 192.168.79.102 hadoop102   | 192.168.79.103 hadoop103             | 192.168.79.104 hadoop104            |
| ---- | -------------------------- | ------------------------------------ | ----------------------------------- |
| HDFS | **`NameNode`**<br>DataNode | <br>DataNode                         | **`SecondaryNameNode`**<br>DataNode |
| YARN | NodeManager                | **`ResourceManager`**<br>NodeManager | <br>NodeManager                     |

ğŸ¯é…ç½®æ–‡ä»¶è¯´æ˜ï¼šHadoop é…ç½®æ–‡ä»¶åˆ†ä¸¤ç±»ï¼Œ**é»˜è®¤é…ç½®æ–‡ä»¶**å’Œ**è‡ªå®šä¹‰é…ç½®æ–‡ä»¶**ï¼Œåªæœ‰ç”¨æˆ·æƒ³ä¿®æ”¹æŸä¸€é»˜è®¤é…ç½®å€¼æ—¶ï¼Œæ‰éœ€è¦ä¿®æ”¹è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼Œæ›´æ”¹ç›¸åº”å±æ€§å€¼

> é»˜è®¤é…ç½®æ–‡ä»¶

| é»˜è®¤é…ç½®æ–‡ä»¶       | æ–‡ä»¶å­˜æ”¾åœ¨ Hadoop çš„ jar åŒ…ä¸­çš„ä½ç½®                       |
| ------------------ | --------------------------------------------------------- |
| core-default.xml   | hadoop-common-3.1.3.jar/core-default.xml                  |
| hdfs-default.xml   | hadoop-hdfs-3.1.3.jar/hdfs-default.xml                    |
| yarn-default.xml   | hadoop-yarn-common-3.1.3.jar/yarn-default.xml             |
| mapred-default.xml | hadoop-mapreduce-client-core-3.1.3.jar/mapred-default.xml |

>è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼ˆå¸¸ç”¨ï¼‰

`core-site.xmlã€hdfs-site.xmlã€yarn-site.xmlã€mapred-site.xml`ã€`workers` äº”ä¸ªé…ç½®æ–‡ä»¶å­˜æ”¾åœ¨`/opt/module/hadoop-3.1.3/etc/hadoop`è¿™ä¸ªè·¯å¾„ä¸Šï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚é‡æ–°è¿›è¡Œä¿®æ”¹é…ç½®

![image-20230818165403796](img.assets\image-20230818165403796.png)

![image-20230818165511786](img.assets\image-20230818165511786.png)

ä»¥ä¸‹é…ç½®åœ¨  192.168.79.102 hadoop102 ä¸­è¿›è¡Œ

#### 4.2.5.1 core-site.xml 

ğŸ¯æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š`vim core-site.xml`ï¼Œç›¸å½“äºå†…éƒ¨é€šè®¯ï¼Œåœ¨`<configuration>`å’Œ`</configuration>`ä¹‹é—´æ’å…¥

```xml
    <!-- æŒ‡å®šNameNodeçš„åœ°å€ -->
    <property>
        <name>fs.defaultFS</name>
        <value>hdfs://192.168.79.102:8020</value>
    </property>

    <!-- æŒ‡å®šhadoopæ•°æ®çš„å­˜å‚¨ç›®å½•ï¼Œæ ¹æ®è‡ªèº«æƒ…å†µåšå‡ºæ›´æ”¹ -->
    <property>
        <name>hadoop.tmp.dir</name>
        <value>/opt/module/hadoop-3.1.3/data</value>
    </property>

    <!-- é…ç½®HDFSç½‘é¡µç™»å½•ä½¿ç”¨çš„é™æ€ç”¨æˆ·ä¸ºroot -->
    <property>
        <name>hadoop.http.staticuser.user</name>
        <value>root</value>
    </property>
```



#### 4.2.5.2 hdfs-site.xml

ğŸ¯HDFSé…ç½®æ–‡ä»¶ï¼šå¤–éƒ¨é€šè®¯çš„æ¥å£ï¼Œ`vim hdfs-site.xml`ï¼Œåœ¨`<configuration>`å’Œ`</configuration>`ä¹‹é—´æ’å…¥ä»¥ä¸‹å†…å®¹

```xml
     <!-- nn webç«¯è®¿é—®åœ°å€-->
    <property>
        <name>dfs.namenode.http-address</name>
        <value>192.168.79.102:9870</value>
    </property>
        <!-- 2nn webç«¯è®¿é—®åœ°å€-->
    <property>
        <name>dfs.namenode.secondary.http-address</name>
        <value>192.168.79.104:9868</value>
    </property>
```



#### 4.2.5.3 yarn-site.xml

ğŸ¯YARNé…ç½®æ–‡ä»¶ï¼š`vim yarn-site.xml`ï¼Œåœ¨`<configuration>`å’Œ`</configuration>`ä¹‹é—´æ’å…¥ä»¥ä¸‹å†…å®¹

```xml
    <!-- æŒ‡å®šMRèµ°shuffle -->
    <property>
        <name>yarn.nodemanager.aux-services</name>
        <value>mapreduce_shuffle</value>
    </property>

    <!-- æŒ‡å®šResourceManagerçš„åœ°å€-->
    <property>
        <name>yarn.resourcemanager.hostname</name>
        <value>192.168.79.103</value>
    </property>

    <!-- ç¯å¢ƒå˜é‡çš„ç»§æ‰¿ è§£å†³3.1.3ç‰ˆæœ¬çš„å°bug -->
    <property>
        <name>yarn.nodemanager.env-whitelist</name>
                <value>JAVA_HOME,HADOOP_COMMON_HOME,HADOOP_HDFS_HOME,HADOOP_CONF_DIR,CLASSPATH_PREPEND_DISTCACHE,HADOOP_YARN_HOME,HADOOP_MAPRED_HOME</value>
    </property>
```



#### 4.2.5.4 mapred-site.xml

ğŸ¯MapReduceé…ç½®æ–‡ä»¶ï¼š`mapred-site.xml`,åœ¨`<configuration>`å’Œ`</configuration>`ä¹‹é—´æ’å…¥ä»¥ä¸‹å†…å®¹

```xml
<!-- æŒ‡å®šMapReduceç¨‹åºè¿è¡Œåœ¨Yarnä¸Š -->
    <property>
        <name>mapreduce.framework.name</name>
        <value>yarn</value>
    </property>
```



#### 4.2.5.5 workers

ğŸ¯é…ç½®workersï¼š`vim /opt/module/hadoop-3.1.3/etc/hadoop/workers `ï¼Œå¢åŠ ä»¥ä¸‹å†…å®¹ï¼ˆè¯¥æ–‡ä»¶ä¸­æ·»åŠ çš„å†…å®¹ç»“å°¾ä¸å…è®¸æœ‰ç©ºæ ¼ï¼Œæ–‡ä»¶ä¸­ä¸å…è®¸æœ‰ç©ºè¡Œï¼‰

```
192.168.79.102
192.168.79.103
192.168.79.104
```



#### 4.2.5.6 åˆ†å‘åˆ°å…¶ä»–è™šæ‹Ÿæœº

```
xsync hadoop/
```



### 4.2.6 å¯åŠ¨é›†ç¾¤

ğŸ¯å¯åŠ¨é›†ç¾¤ï¼šå¦‚æœé›†ç¾¤æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œéœ€è¦åœ¨ 192.168.79.102 hadoop102 èŠ‚ç‚¹æ ¼å¼åŒ– NameNode

```
# åœ¨hadoopæ ¹ç›®å½•è¾“å…¥
hdfs namenode -format
# éšåä¼šäº§ç”Ÿdataå’Œlogsä¸¤ä¸ªæ–‡ä»¶
```

>æ ¼å¼åŒ– NameNodeï¼Œä¼šäº§ç”Ÿæ–°çš„é›†ç¾¤ idï¼Œå¯¼è‡´ NameNode å’Œ DataNode çš„é›†ç¾¤ id ä¸ä¸€è‡´ï¼Œé›†ç¾¤æ‰¾ä¸åˆ°å·²å¾€æ•°æ®ã€‚å¦‚æœé›†ç¾¤åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™ï¼Œéœ€è¦é‡æ–°æ ¼å¼åŒ– NameNode çš„è¯ï¼Œä¸€å®šè¦å…ˆåœæ­¢ namenode å’Œ datanode è¿›ç¨‹ï¼Œå¹¶ä¸”è¦åˆ é™¤æ‰€æœ‰æœºå™¨çš„ data å’Œ logs ç›®å½•ï¼Œç„¶åå†è¿›è¡Œæ ¼å¼åŒ–
>
>- æ€è¿›ç¨‹sbin/stop-dfs.sh
>- åˆ é™¤æ¯ä¸ªè™šæ‹Ÿæœºä¸Šçš„logså’Œdata
>- æ ¼å¼åŒ–NameNodeï¼šhdfs namenode -format

![image-20230821093217625](img.assets\image-20230821093217625.png)

åœ¨ /opt/module/hadoop-3.1.3/data/dfs/name/current æœ‰ä¸€ä¸ª `VERSION `,ä¿å­˜ç€é›†ç¾¤id

![image-20230821093354881](img.assets\image-20230821093354881.png)

#### 4.2.6.1 å¯åŠ¨HDFS

åœ¨hadoopçš„`sbin`ç›®å½•ä¸‹æ‰§è¡Œ

```
start-dfs.sh
```

ğŸ¯æŸ¥çœ‹æ˜¯å¦å¯åŠ¨æˆåŠŸï¼š

```
# jpsæŸ¥çœ‹å¯åŠ¨çš„è¿›ç¨‹(Javaè¿›ç¨‹çš„ç›¸å…³ä¿¡æ¯)
jps
```

ğŸ¤¯å¯åŠ¨hadoopé›†ç¾¤æ—¶è¿˜æœ‰å¯èƒ½ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯

```
Starting namenodes on [hadoop102]
ERROR: Attempting to operate on hdfs namenode as root
ERROR: but there is no HDFS_NAMENODE_USER defined. Aborting operation.
Starting datanodes
ERROR: Attempting to operate on hdfs datanode as root
ERROR: but there is no HDFS_DATANODE_USER defined. Aborting operation.
Starting secondary namenodes [192.168.79.104]
ERROR: Attempting to operate on hdfs secondarynamenode as root
ERROR: but there is no HDFS_SECONDARYNAMENODE_USER defined. Aborting operation.
```

ğŸ¯è§£å†³æ–¹æ¡ˆï¼š

```sh
vim /etc/profile
# åœ¨ç¯å¢ƒå˜é‡ä¸­æ·»åŠ ä¸‹é¢çš„é…ç½®
export HDFS_NAMENODE_USER=root
export HDFS_DATANODE_USER=root
export HDFS_SECONDARYNAMENODE_USER=root
export YARN_RESOURCEMANAGER_USER=root
export YARN_NODEMANAGER_USER=root

#åˆ·æ–°é…ç½®
source /etc/profile
xsync /etc/profile
```



ğŸ¤¯å‡ºç°JAVA_HOMEæ— æ³•æ‰¾åˆ°çš„é—®é¢˜

```
hadoop101: ERROR: JAVA_HOME is not set and could not be found.
```

æ‰¾åˆ°å®‰è£…Hadoopçš„ä½ç½®ï¼Œåœ¨hadoopå®‰è£…çš„ç›®å½•ä¸‹æœ‰ä¸ªhadoop-envçš„æ–‡ä»¶ã€‚

![image-20230821113011092](img.assets\image-20230821113011092.png)

åœ¨`export JAVA_HOME=`çš„åœ°æ–¹æ·»åŠ å®‰è£…çš„jdkçš„ç»å¯¹è·¯å¾„

![image-20230821115904142](img.assets\image-20230821115904142.png)



#### 4.2.6.2 å¯åŠ¨YARN

ğŸ¯å¯åŠ¨YARNï¼ˆ192.168.79.103 hadoop103 ä¸Šå¯åŠ¨ï¼‰

```
# åŒæ ·åœ¨hadoopæ ¹ç›®å½•ä¸‹
sbin/start-yarn.sh

# jpsæŸ¥çœ‹å¯åŠ¨çš„è¿›ç¨‹
jps
```



#### 4.2.6.3 webæŸ¥çœ‹

> webç«¯æŸ¥çœ‹ `HDFS` çš„ NameNodeï¼šæµè§ˆå™¨ä¸­è¾“å…¥ http://192.168.79.102:9870

![image-20230821122531617](img.assets\image-20230821122531617.png)

> Web ç«¯æŸ¥çœ‹`YARN` çš„ ResourceManagerï¼šæµè§ˆå™¨ä¸­è¾“å…¥http://192.168.79.103:8088

![image-20230821122556513](img.assets\image-20230821122556513.png)



#### 4.2.6.4 é›†ç¾¤æµ‹è¯•

```
# åˆ›å»ºä¸€ä¸ªç›®å½•
hadoop fs -mkdir /input
# ä¸Šä¼ æ–‡ä»¶
hadoop fs -put wcinput/word.txt /input
```

![image-20230821141339149](img.assets\image-20230821141339149.png)

> ä¸‹è½½æŸ¥çœ‹éœ€è¦é…ç½®ä¸»æœºåå’Œipåœ°å€çš„æ˜ å°„

æŸ¥çœ‹**ä¸Šä¼ æ–‡ä»¶åæŸ¥çœ‹æ–‡ä»¶å­˜æ”¾çš„ä½ç½®**

HDFSçš„å­˜å‚¨è·¯å¾„ï¼š

![image-20230821143123283](img.assets\image-20230821143123283.png)

æŸ¥çœ‹HDFSåœ¨ç£ç›˜å­˜å‚¨æ–‡ä»¶å†…å®¹ï¼š`cat blk_1073741825`ï¼Œå¯ä»¥å‘ç°`blk_ä¸€é•¿ä¸²æ•°å­—`å³æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå¯ä»¥è¿›è¡ŒæŸ¥çœ‹ã€è§£å‹ç­‰æ“ä½œ

ğŸ¯æµ‹è¯•YARNï¼ˆéœ€è¦è®¡ç®—æ—¶æ‰ä¼šæ˜¾ç¤ºä»»åŠ¡ï¼‰ï¼š

```sh
# hadoopæ ¹ç›®å½•ä¸‹
hadoop jar share/hadoop/mapreduce/hadoop-mapreduce-examples-3.1.3.jar wordcount /input /output
```

![image-20230821150255812](img.assets\image-20230821150255812.png)

> åœ¨HDFSé¡µé¢ä¸­æŸ¥çœ‹è®¡ç®—ç»“æœ

![image-20230821150515388](img.assets\image-20230821150515388.png)



#### 4.2.6.5 é…ç½®å†å²æœåŠ¡å™¨

ä¸ºäº†æŸ¥çœ‹ç¨‹åºçš„å†å²è¿è¡Œæƒ…å†µï¼Œéœ€è¦é…ç½®ä¸€ä¸‹å†å²æœåŠ¡å™¨

ğŸ¯é…ç½®mapred-site.xml

```
vim /opt/module/hadoop-3.1.3/etc/hadoop/mapred-site.xml
```

```xml
<!-- å†å²æœåŠ¡å™¨ç«¯åœ°å€(ä¾›å†…éƒ¨) -->
<property>
	<name>mapreduce.jobhistory.address</name>
	<value>192.168.79.102:10020</value>
</property>
<!-- å†å²æœåŠ¡å™¨ web ç«¯åœ°å€ï¼ˆä¾›å¤–éƒ¨ï¼‰ -->
<property>
	<name>mapreduce.jobhistory.webapp.address</name>
	<value>192.168.79.102:19888</value>
</property>
```

ğŸ¯å›åˆ°`/opt/module/hadoop-3.1.3/etc/hadoop`åˆ†å‘é…ç½®

```
xsync mapred-site.xml
```

>!é‡å¯yarn `stop-yarn.sh`

192.168.79.102 hadoop102ä¸Šå¯åŠ¨å†å²æœåŠ¡å™¨

```
sbin/mapred --daemon start historyserver
```

æŸ¥çœ‹æ˜¯å¦å¯åŠ¨

```
jps
```

![image-20230821152956699](img.assets\image-20230821152956699.png)

æŸ¥çœ‹å†å²æœåŠ¡å™¨

![image-20230821153640343](img.assets\image-20230821153640343.png)



#### 4.2.6.6 é…ç½®æ—¥å¿—çš„èšé›†

![image-20230821154027546](img.assets\image-20230821154027546.png)

ç‚¹å‡»logså‘ç°

![image-20230821154107658](img.assets\image-20230821154107658.png)

æ²¡æœ‰é…ç½®æ—¥å¿—çš„èšé›†åŠŸèƒ½

**æ—¥å¿—èšé›†æ¦‚å¿µ**ï¼šåº”ç”¨è¿è¡Œå®Œæˆä»¥åï¼Œå°†ç¨‹åºè¿è¡Œæ—¥å¿—ä¿¡æ¯ä¸Šä¼ åˆ°HDFSç³»ç»Ÿä¸Šï¼Œå¯ä»¥æ–¹ä¾¿çš„æŸ¥çœ‹åˆ°ç¨‹åºè¿è¡Œè¯¦æƒ…ï¼Œæ–¹ä¾¿å¼€å‘è°ƒè¯•

![image-20230821154245327](img.assets\image-20230821154245327.png)

å¼€å¯æ—¥å¿—èšé›†åŠŸèƒ½ï¼Œéœ€è¦**é‡æ–°å¯åŠ¨**NodeManagerã€ResourceManagerå’ŒHistoryServer

> ğŸ¯é…ç½®yarn-site.xml

vim /opt/module/hadoop-3.1.3/etc/hadoop/yarn-site.xml

```xml
<!-- å¼€å¯æ—¥å¿—èšé›†åŠŸèƒ½ -->
<property>
	<name>yarn.log-aggregation-enable</name>
	<value>true</value>
</property>
<!-- è®¾ç½®æ—¥å¿—èšé›†æœåŠ¡å™¨åœ°å€ -->
<property> 
	<name>yarn.log.server.url</name> 
	<value>http://192.168.79.102:19888/jobhistory/logs</value>
</property>
<!-- è®¾ç½®æ—¥å¿—ä¿ç•™æ—¶é—´ä¸º 7 å¤© -->
<property>
	<name>yarn.log-aggregation.retain-seconds</name>
	<value>604800</value>
</property>
```

ğŸ¯ä¿å­˜ä¹‹ååˆ†å‘

```
xsync yarn-site.xml
```

ğŸ¯é‡å¯NodeManager ã€ResourceManager å’Œ HistoryServerï¼Œå•ä¸ªæœåŠ¡åœæ­¢

```
mapred --daemon stop historyserver
```

åˆ‡æ¢è‡³ 192.168.79.103 hadoop103ä¸Š

```
sbin/stop-yarn.sh   sbin/start-yarn.sh
```

åˆ‡å›192.168.79.102 hadoop102

```
mapred --daemon start historyserver
```

ğŸ¯æµ‹è¯•

![image-20230821155805019](img.assets\image-20230821155805019.png)



#### 4.2.6.7 é›†ç¾¤å¯åŠ¨/åœæ­¢æ–¹å¼

ğŸ¯å„ä¸ª**æ¨¡å—**åˆ†å¼€å¯åŠ¨/åœæ­¢ï¼ˆé…ç½® ssh æ˜¯å‰æï¼‰

```sh
# æ•´ä½“å¯åŠ¨/åœæ­¢HDFS
start-dfs.sh
stop-dfs.sh
# æ•´ä½“å¯åŠ¨/åœæ­¢yarnï¼ˆhadoop103ï¼‰
start-yarn.sh
stop-yarn.sh
```

ğŸ¯å„ä¸ª**æœåŠ¡ç»„ä»¶**é€ä¸€å¯åŠ¨/åœæ­¢

```sh
# å•ç‹¬å¯åŠ¨/åœæ­¢HDFSç»„ä»¶ï¼ˆnamenodeæˆ–datanodeæˆ–secondarynamenodeå…¶ä¸­ä¹‹ä¸€ï¼‰
hdfs --daemon start namenodeæˆ–datanodeæˆ–secondarynamenode
hdfs --daemon stop namenodeæˆ–datanodeæˆ–secondarynamenode
# å•ç‹¬å¯åŠ¨/åœæ­¢YARNç»„ä»¶
yarn --daemon stop resourcemanageræˆ–nodemanager
yarn --daemon stop resourcemanageræˆ–nodemanage
```

ğŸ¯æ³¨æ„åˆ°ä¸Šè¿°æ“ä½œç¹æ‚é‡å¤ï¼Œæ•…å¯ä»¥ç”¨**è„šæœ¬ä¸€é”®**å¯åŠ¨/å…³åœæ‰€æœ‰`vim /root/bin/myhadoop.sh`ï¼š

```sh
#!/bin/bash
if [ $# -lt 1 ]
then
 echo "No Args Input..."
 exit ;
fi
case $1 in
"start")
 echo " =================== å¯åŠ¨ hadoop é›†ç¾¤ ==================="
 echo " --------------- å¯åŠ¨ hdfs ---------------"
 ssh 192.168.79.102 "/opt/module/hadoop-3.1.3/sbin/start-dfs.sh"
 echo " --------------- å¯åŠ¨ yarn ---------------"
 ssh 192.168.79.103 "/opt/module/hadoop-3.1.3/sbin/start-yarn.sh"
 echo " --------------- å¯åŠ¨ historyserver ---------------"
 ssh 192.168.79.102 "/opt/module/hadoop-3.1.3/bin/mapred --daemon start historyserver"
;;
"stop")
 echo " =================== å…³é—­ hadoop é›†ç¾¤ ==================="
 echo " --------------- å…³é—­ historyserver ---------------"
 ssh 192.168.79.102 "/opt/module/hadoop-3.1.3/bin/mapred --daemon stop historyserver"
 echo " --------------- å…³é—­ yarn ---------------"
 ssh 192.168.79.103 "/opt/module/hadoop-3.1.3/sbin/stop-yarn.sh"
 echo " --------------- å…³é—­ hdfs ---------------"
 ssh 192.168.79.102 "/opt/module/hadoop-3.1.3/sbin/stop-dfs.sh"
;;
*)
 echo "Input Args Error..."
;;
esac
```

ğŸ¯å…ˆåŠ ä¸Šæƒé™`chmod 777 myhadoop.sh`ï¼Œå†åˆ†å‘è„šæœ¬`xsync myhadoop.sh`
ğŸ¯`myhadoop.sh start`ä¸€é”®å¯åŠ¨ã€`myhadoop.sh stop`ä¸€é”®å…³åœ

> å…³é—­å‡ºç°ä»¥ä¸‹é”™è¯¯

```

[root@hadoop102 bin]# myhadoop.sh stop
 =================== å…³é—­ hadoop é›†ç¾¤ ===================
 --------------- å…³é—­ historyserver ---------------
 --------------- å…³é—­ yarn ---------------
Stopping nodemanagers
ERROR: Attempting to operate on yarn nodemanager as root
ERROR: but there is no YARN_NODEMANAGER_USER defined. Aborting operation.
Stopping resourcemanager
ERROR: Attempting to operate on yarn resourcemanager as root
ERROR: but there is no YARN_RESOURCEMANAGER_USER defined. Aborting operation.
 --------------- å…³é—­ hdfs ---------------
Stopping namenodes on [hadoop102]
Stopping datanodes
ERROR: Attempting to operate on hdfs namenode as root
ERROR: but there is no HDFS_NAMENODE_USER defined. Aborting operation.
ERROR: Attempting to operate on hdfs datanode as root
ERROR: but there is no HDFS_DATANODE_USER defined. Aborting operation.
Stopping secondary namenodes [hadoop104]
ERROR: Attempting to operate on hdfs secondarynamenode as root
ERROR: but there is no HDFS_SECONDARYNAMENODE_USER defined. Aborting operation.
```

ğŸ¯è§£å†³æ–¹æ³•ï¼š`vim /opt/module/hadoop-3.1.3/etc/hadoop/hadoop-env.sh`

```sh
export HDFS_NAMENODE_USER=root
export HDFS_DATANODE_USER=root
export HDFS_SECONDARYNAMENODE_USER=root
export YARN_RESOURCEMANAGER_USER=root
export YARN_NODEMANAGER_USER=root
```

![image-20230821162233396](img.assets\image-20230821162233396.png)



#### 4.2.6.8 æŸ¥è¯¢æ‰€æœ‰jps

ğŸ¯ä¸€é”®æŸ¥çœ‹æ‰€æœ‰æœåŠ¡å™¨javaè¿›ç¨‹çš„è„šæœ¬ï¼Œæ‹’ç»ä¸€å°ä¸€å°jpsï¼Œ`vim /root/bin/jpsall`ï¼š

```sh
#!/bin/bash
for host in 192.168.79.102 192.168.79.103 192.168.79.104
do
        echo =============== $host ===============
        ssh $host $JAVA_HOME/bin/jps
done
```

ğŸ¯å…ˆåŠ ä¸Šæƒé™`chmod 777 myhadoop.sh`ï¼Œå†åˆ†å‘è„šæœ¬`xsync jpsall`ï¼Œæœ€å`jpsall` å³å¯æŸ¥çœ‹



### 4.2.7 Hadoopå¸¸ç”¨ç«¯å£

| ç«¯å£åç§°                   | Hadoop2.x   | Hadoop3.x          |
| -------------------------- | ----------- | ------------------ |
| NameNode å†…éƒ¨é€šä¿¡ç«¯å£      | 8020 / 9000 | `8020 `/ 9000/9820 |
| NameNode HTTP UI           | `50070`     | `9870`             |
| MapReduce æŸ¥çœ‹æ‰§è¡Œä»»åŠ¡ç«¯å£ | 8088        | 8088               |
| å†å²æœåŠ¡å™¨é€šä¿¡ç«¯å£         | 19888       | 19888              |



### 4.2.8 é›†ç¾¤æ—¶é—´åŒæ­¥

ï¼ˆ**äº†è§£å³å¯ï¼Œå½±å“æ€§èƒ½ï¼Œæ— éœ€æ“ä½œ**ï¼‰

å¦‚æœæœåŠ¡å™¨åœ¨å…¬ç½‘ç¯å¢ƒï¼ˆèƒ½è¿æ¥å¤–ç½‘ï¼‰ï¼Œå¯ä»¥ä¸é‡‡ç”¨é›†ç¾¤æ—¶é—´åŒæ­¥ï¼Œå› ä¸ºæœåŠ¡å™¨ä¼šå®šæœŸ å’Œå…¬ç½‘æ—¶é—´è¿›è¡Œæ ¡å‡†ï¼›

å¦‚æœæœåŠ¡å™¨åœ¨å†…ç½‘ç¯å¢ƒï¼Œå¿…é¡»è¦é…ç½®é›†ç¾¤æ—¶é—´åŒæ­¥ï¼Œå¦åˆ™æ—¶é—´ä¹…äº†ï¼Œä¼šäº§ç”Ÿæ—¶é—´åå·®ï¼Œ å¯¼è‡´é›†ç¾¤æ‰§è¡Œä»»åŠ¡æ—¶é—´ä¸åŒæ­¥



![image-20230821163829434](img.assets\image-20230821163829434.png)

NTPDï¼ˆNetwork Time Protocol daemonï¼‰æ˜¯Linuxæ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œå…¶å®Œæ•´çš„å®ç°äº† NTP åè®®ï¼Œç”¨äºæ ¡æ­£æœ¬åœ°ç³»ç»Ÿä¸æ—¶é’ŸæºæœåŠ¡å™¨ä¹‹å‰çš„æ—¶é—´

ğŸ¯æŸ¥çœ‹æ‰€æœ‰èŠ‚ç‚¹ ntpd æœåŠ¡çŠ¶æ€å’Œå¼€æœºè‡ªå¯çŠ¶æ€(centos8ä¸ºchronyd)

```sh
systemctl status ntpd
# å¯åŠ¨ ntpd
systemctl start ntpd
# æŸ¥çœ‹å¼€æœºæ˜¯å¦è‡ªå¯
systemctl is-enabled ntpd
# å¼€æœºè‡ªå¯
systemctl enable ntpd
```

ğŸ¯ä¿®æ”¹ `ntp.conf` æ–‡ä»¶ï¼Œ`vim /etc/ntp.conf`

```sh
# å°†è¿™ä¸€è¡Œå»æ‰æ³¨é‡Šï¼Œå¹¶ä¿®æ”¹ä¸ºè‡ªå·±çš„ç½‘æ®µ
restrict 192.168.79.0 mask 255.255.255.0 nomodify notrap

# é›†ç¾¤åœ¨å±€åŸŸç½‘ä¸­ï¼Œä¸ä½¿ç”¨å…¶ä»–äº’è”ç½‘ä¸Šçš„æ—¶é—´ï¼Œæ³¨é‡Šä»¥ä¸‹4è¡Œ
#server 0.centos.pool.ntp.org iburst
#server 1.centos.pool.ntp.org iburst
#server 2.centos.pool.ntp.org iburst
#server 3.centos.pool.ntp.org iburst

# å¹¶åœ¨ç»“å°¾åŠ ä¸Šï¼ˆå½“è¯¥èŠ‚ç‚¹ä¸¢å¤±ç½‘ç»œè¿æ¥ï¼Œä¾ç„¶å¯ä»¥é‡‡ç”¨æœ¬åœ°æ—¶é—´ä½œä¸ºæ—¶é—´æœåŠ¡å™¨ä¸ºé›†ç¾¤ä¸­çš„å…¶ä»–èŠ‚ç‚¹æä¾›æ—¶é—´åŒæ­¥ï¼‰
server 127.127.1.0
fudge 127.127.1.0 stratum 10
```

ğŸ¯ä¿®æ”¹ 192.168.79.102 hadoop102çš„`/etc/sysconfig/ntpd`ï¼Œ`vim /etc/sysconfig/ntpd`:

```
# å¢åŠ (è®©ç¡¬ä»¶æ—¶é—´å’Œç³»ç»Ÿæ—¶é—´ä¸€èµ·åŒæ­¥ï¼Œæ—¶é—´æ›´ç²¾å‡†)
SYNC_HWCLOCK=yes
```

ğŸ¯é‡å¯ntdpæœåŠ¡

```
systemctl start ntdp
```

ğŸ¯å…¶ä»–æœºå™¨é…ç½®

```sh
# å…³é—­æ‰€æœ‰èŠ‚ç‚¹ä¸ŠntdpæœåŠ¡å’Œè‡ªå¯åŠ¨
systemctl stop ntdp
systemctl disable ntdp

# åœ¨å…¶ä»–æœºå™¨ä¸Šé…ç½®æ¯1åˆ†é’Ÿä¸æ—¶é—´æœåŠ¡å™¨åŒæ­¥ä¸€æ¬¡
crontab -e
*/1 * * * * /usr/sbin/ntpdate 192.168.79.102
```



### 4.2.9 å¸¸è§é”™è¯¯

ğŸ¯DataNodeå’ŒNameNodeè¿›ç¨‹åŒæ—¶åªèƒ½å·¥ä½œä¸€ä¸ª

![image-20230821164839070](img.assets\image-20230821164839070.png)



ğŸ¯8088 ç«¯å£è¿æ¥ä¸ä¸Š

> cat /etc/hosts

æ³¨é‡Šæ‰å¦‚ä¸‹ä»£ç 

```
#127.0.0.1 localhost localhost.localdomain localhost4 localhost4.localdomain4
#::1 hadoop102
```

